<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Scratchpad</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icons/icon-192x192.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Custom styles for the modes */
        .light-mode {
            background-color: #fafafa; /* A lighter shade of grey */
            color: #000000; /* Black */
        }

        .dark-mode {
            background-color: #000000; /* Black */
            color: #32CD32; /* Lime green */
        }

        /* Ensure textarea fills the available space and matches mode colors */
        /* Add padding to the bottom to prevent content from being hidden by the fixed footer */
        body {
            /* padding-bottom will be set by JavaScript */
            margin: 0; /* Remove default body margin */
            display: flex; /* Use flexbox for body to manage layout */
            flex-direction: column; /* Stack children vertically */
            min-height: 100vh; /* Ensure body takes at least full viewport height */
        }

        .full-height-textarea {
            flex-grow: 1; /* Allows the textarea to take up available space */
            resize: none; /* Disable manual resizing */
            outline: none; /* Remove outline on focus */
            padding: 1rem; /* Add some padding inside the textarea */
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; /* Monospace font for scratchpad feel */
            /* Inherit colors from parent body based on mode */
            background-color: inherit;
            color: inherit;
            width: 100%; /* Ensure textarea takes full width */
            box-sizing: border-box; /* Include padding in the element's total width and height */
        }

        /* Style for buttons (now icon buttons) */
        .app-button {
            display: flex; /* Use flexbox to center icon */
            justify-content: center;
            align-items: center;
            width: 3rem; /* Fixed width for icon buttons */
            height: 3rem; /* Fixed height for icon buttons */
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer; /* Indicate clickable */
        }

        .light-mode .app-button {
            background-color: #cccccc; /* Grey button in light mode */
            color: #000000;
        }

        .dark-mode .app-button {
            background-color: #333333; /* Dark grey button in dark mode */
            color: #32CD32; /* Lime green text */
        }

        .app-button:hover {
             opacity: 0.9;
        }

         /* Style for the message box */
        .message-box {
            position: fixed;
            bottom: 5rem; /* Position above the fixed footer initially */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .message-box.show {
            opacity: 1;
        }

        /* Styles for the toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #32CD32; /* Lime green when checked */
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #32CD32;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Styles for the fixed footer container */
        .fixed-footer {
            position: fixed;
            bottom: 0; /* Initially at the very bottom */
            left: 0;
            right: 0;
            display: flex; /* Use flexbox to align items */
            justify-content: space-between; /* Distribute items with space between */
            align-items: center; /* Vertically center items */
            padding: 1rem; /* Add padding around the items */
            background-color: inherit; /* Inherit background color from body for mode change */
            z-index: 999; /* Ensure it's above other content but below message box */
            width: 100%; /* Ensure footer takes full width */
            box-sizing: border-box; /* Include padding in the element's total width */
            transition: bottom 0.3s ease-out; /* Smooth transition when bottom changes */
        }

        /* Add margin to the copy button to help center it */
        #copyButton {
             margin: 0 auto; /* Auto margins push the element to the center in a flex container */
        }


    </style>
</head>
<body class="flex flex-col h-screen light-mode">
    <textarea id="noteTextarea" class="full-height-textarea"></textarea>

    <div class="fixed-footer">
        <label class="toggle-switch">
            <input type="checkbox" id="modeToggleCheckbox">
            <span class="slider"></span>
        </label>

        <button id="copyButton" class="app-button">
            <i class="fas fa-copy"></i>
        </button>

        <button id="clearButton" class="app-button">
             <i class="fas fa-trash-alt"></i>
        </button>
    </div>


    <div id="messageBox" class="message-box"></div>

    <script>
        const body = document.body;
        const noteTextarea = document.getElementById('noteTextarea');
        const modeToggleCheckbox = document.getElementById('modeToggleCheckbox'); // Renamed to reflect checkbox
        const clearButton = document.getElementById('clearButton');
        const copyButton = document.getElementById('copyButton');
        const messageBox = document.getElementById('messageBox');
        const fixedFooter = document.querySelector('.fixed-footer');

        // Load mode preference from localStorage
        const savedMode = localStorage.getItem('mode');
        if (savedMode) {
            body.classList.remove('light-mode', 'dark-mode');
            body.classList.add(savedMode);
            // Set the checkbox state based on the loaded mode
            modeToggleCheckbox.checked = savedMode === 'dark-mode';
        } else {
            // Default to light mode if no preference is saved
            body.classList.add('light-mode');
            modeToggleCheckbox.checked = false; // Ensure checkbox is unchecked for light mode
        }

        // Load saved text from localStorage
        const savedText = localStorage.getItem('noteContent');
        if (savedText) {
            noteTextarea.value = savedText;
        }

        // Function to show a message box
        function showMessage(message) {
            messageBox.textContent = message;
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 2000); // Hide after 2 seconds
        }

        // Event listener for mode toggle checkbox change
        modeToggleCheckbox.addEventListener('change', () => {
            if (modeToggleCheckbox.checked) {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                localStorage.setItem('mode', 'dark-mode');
            } else {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                localStorage.setItem('mode', 'light-mode');
            }
        });

        // Event listener for clear button
        clearButton.addEventListener('click', () => {
            noteTextarea.value = '';
            localStorage.removeItem('noteContent'); // Clear saved text from localStorage
        });

        // Event listener for copy button
        copyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(noteTextarea.value);
                showMessage('Content copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy: ', err);
                showMessage('Failed to copy content.');
            }
        });

        // Save text to localStorage whenever the user types
        noteTextarea.addEventListener('input', () => {
            localStorage.setItem('noteContent', noteTextarea.value);
        });

        // Register the service worker
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => {
                console.log('Service Worker registered: ', registration);
              })
              .catch(error => {
                console.log('Service Worker registration failed: ', error);
              });
          });
        }

        // Function to adjust layout based on visual viewport (including keyboard)
        function adjustLayoutForKeyboard() {
            if (window.visualViewport) {
                const viewportHeight = window.visualViewport.height;
                const layoutViewportHeight = window.innerHeight;
                const keyboardHeight = layoutViewportHeight - viewportHeight;

                // Adjust the bottom position of the fixed footer
                fixedFooter.style.bottom = `${keyboardHeight}px`;

                // Adjust the padding-bottom of the body to ensure textarea content is visible above the footer and keyboard
                const footerHeight = fixedFooter.offsetHeight;
                body.style.paddingBottom = `${footerHeight + keyboardHeight + 16}px`; // Add a little extra padding
                 // Also adjust message box position relative to the new footer position
                messageBox.style.bottom = `${keyboardHeight + footerHeight + 16}px`; // Position above the footer
            } else {
                 // Fallback for browsers that don't support visualViewport
                 // We'll keep the original padding-bottom and footer position
                 body.style.paddingBottom = '6rem';
                 fixedFooter.style.bottom = '0';
                 messageBox.style.bottom = '5rem';
            }
        }

        // Adjust layout on initial load and on visual viewport resize (keyboard appearance/disappearance)
        window.addEventListener('load', adjustLayoutForKeyboard);
        if (window.visualViewport) {
             window.visualViewport.addEventListener('resize', adjustLayoutForKeyboard);
        } else {
            // Add a regular resize listener as a fallback if visualViewport is not supported
            window.addEventListener('resize', adjustLayoutForKeyboard);
        }


    </script>
</body>
</html>
